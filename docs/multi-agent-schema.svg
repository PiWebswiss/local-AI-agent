<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1800" height="1240" viewBox="0 0 1800 1240">
  <defs>
    <style>
      .title { font: 700 34px 'Segoe UI', Arial, sans-serif; fill: #111827; }
      .label { font: 600 19px 'Segoe UI', Arial, sans-serif; fill: #111827; }
      .small { font: 500 16px 'Segoe UI', Arial, sans-serif; fill: #374151; }
      .box { fill: #f8fafc; stroke: #334155; stroke-width: 2; rx: 12; ry: 12; }
      .decision { fill: #eef2ff; stroke: #4338ca; stroke-width: 2; }
      .status { fill: #ecfeff; stroke: #0e7490; stroke-width: 2; rx: 10; ry: 10; }
      .verify { fill: #f0fdf4; stroke: #166534; stroke-width: 2; rx: 12; ry: 12; }
      .final { fill: #fff7ed; stroke: #9a3412; stroke-width: 2; rx: 12; ry: 12; }
      .arrow { stroke: #334155; stroke-width: 2.5; fill: none; marker-end: url(#arrow); }
      .soft-arrow { stroke: #64748b; stroke-width: 2; fill: none; marker-end: url(#arrowSoft); }
      .branch { font: 600 14px 'Segoe UI', Arial, sans-serif; fill: #475569; }
      .panel { fill: #ffffff; stroke: #94a3b8; stroke-width: 1.5; rx: 14; ry: 14; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <polygon points="0,0 10,5 0,10" fill="#334155"/>
    </marker>
    <marker id="arrowSoft" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <polygon points="0,0 10,5 0,10" fill="#64748b"/>
    </marker>
  </defs>

  <rect x="20" y="20" width="1760" height="1200" fill="#ffffff" stroke="#cbd5e1" stroke-width="1.5" rx="16" ry="16"/>
  <text x="70" y="85" class="title">Multi-Agent Runtime Schema (Flow + Thinking Status)</text>
  <text x="70" y="118" class="small">Session memory is RAM-only for current chat; no .agent_memory.json persistence.</text>

  <rect x="70" y="170" width="1670" height="980" class="panel"/>

  <!-- Top pipeline -->
  <rect x="100" y="220" width="220" height="70" class="box"/>
  <text x="210" y="263" text-anchor="middle" class="label">User Prompt</text>

  <rect x="370" y="220" width="240" height="70" class="box"/>
  <text x="490" y="263" text-anchor="middle" class="label">Mode Router</text>

  <rect x="660" y="220" width="270" height="70" class="box"/>
  <text x="795" y="250" text-anchor="middle" class="label">Build Prompt Context</text>
  <text x="795" y="272" text-anchor="middle" class="small">(session memory in RAM)</text>

  <polygon points="1030,220 1210,220 1290,255 1210,290 1030,290 950,255" class="decision"/>
  <text x="1120" y="251" text-anchor="middle" class="label">Committee</text>
  <text x="1120" y="272" text-anchor="middle" class="small">Decision</text>

  <!-- Single model path -->
  <rect x="700" y="370" width="260" height="72" class="box"/>
  <text x="830" y="410" text-anchor="middle" class="label">Single-Model</text>
  <text x="830" y="432" text-anchor="middle" class="small">Primary Answer</text>

  <polygon points="700,510 870,510 940,545 870,580 700,580 630,545" class="decision"/>
  <text x="785" y="541" text-anchor="middle" class="label">Factual Risk?</text>
  <text x="785" y="562" text-anchor="middle" class="small">(chat lookup/challenge)</text>

  <rect x="700" y="650" width="260" height="72" class="status"/>
  <text x="830" y="690" text-anchor="middle" class="label">Second Look</text>
  <text x="830" y="712" text-anchor="middle" class="small">cross-checking answer...</text>

  <!-- Multi-agent path -->
  <rect x="1290" y="350" width="360" height="60" class="status"/>
  <text x="1470" y="387" text-anchor="middle" class="label">group drafting with N models</text>

  <rect x="1290" y="430" width="360" height="60" class="status"/>
  <text x="1470" y="467" text-anchor="middle" class="label">group drafts ready X/N</text>

  <rect x="1290" y="510" width="360" height="60" class="status"/>
  <text x="1470" y="547" text-anchor="middle" class="label">group review ...</text>

  <rect x="1290" y="590" width="360" height="60" class="status"/>
  <text x="1470" y="627" text-anchor="middle" class="label">group merge ...</text>

  <rect x="1290" y="670" width="360" height="60" class="status"/>
  <text x="1470" y="707" text-anchor="middle" class="label">finalizing answer ...</text>

  <!-- Verification and output -->
  <rect x="860" y="850" width="500" height="78" class="verify"/>
  <text x="1110" y="888" text-anchor="middle" class="label">Optional Grounded Verification</text>
  <text x="1110" y="912" text-anchor="middle" class="small">(web/book + quality mode ON)</text>

  <rect x="930" y="1000" width="360" height="78" class="final"/>
  <text x="1110" y="1040" text-anchor="middle" class="label">Final Response</text>
  <text x="1110" y="1064" text-anchor="middle" class="small">(+ sources when available)</text>

  <!-- Arrows top -->
  <path d="M320 255 L370 255" class="arrow"/>
  <path d="M610 255 L660 255" class="arrow"/>
  <path d="M930 255 L950 255" class="arrow"/>

  <!-- Branch arrows -->
  <path d="M1080 292 L860 370" class="arrow"/>
  <text x="930" y="330" class="branch">multi-agent off or N=1</text>

  <path d="M1160 292 L1400 350" class="arrow"/>
  <text x="1290" y="330" class="branch">multi-agent on (N &gt; 1)</text>

  <!-- Single path arrows -->
  <path d="M830 442 L830 510" class="arrow"/>
  <path d="M785 580 L785 650" class="arrow"/>
  <text x="738" y="620" class="branch">Yes</text>
  <path d="M940 545 L1040 850" class="soft-arrow"/>
  <text x="958" y="704" class="branch">No</text>
  <path d="M830 722 L1010 850" class="arrow"/>

  <!-- Multi path arrows -->
  <path d="M1470 410 L1470 430" class="arrow"/>
  <path d="M1470 490 L1470 510" class="arrow"/>
  <path d="M1470 570 L1470 590" class="arrow"/>
  <path d="M1470 650 L1470 670" class="arrow"/>
  <path d="M1470 730 L1250 850" class="arrow"/>

  <!-- Final arrows -->
  <path d="M1110 928 L1110 1000" class="arrow"/>

  <!-- Right-side legend -->
  <rect x="80" y="770" width="690" height="340" class="panel"/>
  <text x="110" y="810" class="label">Terminal Thinking / Status Example</text>
  <text x="110" y="845" class="small">Thinking...</text>
  <text x="110" y="875" class="small">Multi-agent: group drafting with 2/3 models (medium)...</text>
  <text x="110" y="905" class="small">Multi-agent: group drafts ready 1/2</text>
  <text x="110" y="935" class="small">Multi-agent: group drafts ready 2/2</text>
  <text x="110" y="965" class="small">Multi-agent: group review...</text>
  <text x="110" y="995" class="small">Multi-agent: group merge...</text>
  <text x="110" y="1025" class="small">Multi-agent: finalizing answer...</text>
  <text x="110" y="1055" class="small">Second look: cross-checking answer... (single-model factual chat only)</text>
</svg>
